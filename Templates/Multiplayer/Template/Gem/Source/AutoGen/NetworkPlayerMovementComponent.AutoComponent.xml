<?xml version="1.0"?>

<Component
    Name="NetworkPlayerMovementComponent" 
    Namespace="${Name}" 
    OverrideComponent="false" 
    OverrideController="true" 
    OverrideInclude="Source/Components/NetworkPlayerMovementComponent.h"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    
    <ComponentRelation Constraint="Required" HasController="true" Name="NetworkTransformComponent" Namespace="Multiplayer" Include="Multiplayer/Components/NetworkTransformComponent.h" />
    <ComponentRelation Constraint="Required" HasController="true" Name="NetworkAnimationComponent" Namespace="${Name}" Include="Source/Components/NetworkAnimationComponent.h" />
    <ComponentRelation Constraint="Required" HasController="true" Name="NetworkCharacterComponent" Namespace="Multiplayer" Include="Multiplayer/Components/NetworkCharacterComponent.h" />
    <ComponentRelation Constraint="Required" HasController="true" Name="NetworkSimplePlayerCameraComponent" Namespace="${Name}" Include="Source/Components/NetworkSimplePlayerCameraComponent.h" />
    <ComponentRelation Constraint="Weak" HasController="true" Name="NetworkAiComponent" Namespace="${Name}" Include="Source/Components/NetworkAiComponent.h" />

    <Include File="Source/${Name}Types.h"/>

    <NetworkProperty Type="AZ::Vector3" Name="VelocityFromExternalSources" Init="AZ::Vector3::CreateZero()" ReplicateFrom="Authority" ReplicateTo="Client" IsRewindable="true" IsPredictable="true" IsPublic="true" Container="Object" ExposeToEditor="false" ExposeToScript="true" GenerateEventBindings="true" Description="Velocity of applied from other sources"/>
    <NetworkProperty Type="AZ::Vector3" Name="SelfGeneratedVelocity" Init="AZ::Vector3::CreateZero()" ReplicateFrom="Authority" ReplicateTo="Client" IsRewindable="true" IsPredictable="true" IsPublic="true" Container="Object" ExposeToEditor="false" ExposeToScript="true" GenerateEventBindings="true" Description="Velocity generated by this player"/>
    <NetworkProperty Type="float" Name="SecondsSinceOnGround" Init="0.0f" ReplicateFrom="Authority" ReplicateTo="Client" IsRewindable="true" IsPredictable="true" IsPublic="true" Container="Object" ExposeToEditor="false" ExposeToScript="true" GenerateEventBindings="true" Description="Number of seconds since the player was last on the ground"/>
    <NetworkProperty Type="float" Name="SecondsSinceJumpRequest" Init="1000.0f" ReplicateFrom="Authority" ReplicateTo="Client" IsRewindable="true" IsPredictable="true" IsPublic="true" Container="Object" ExposeToEditor="false" ExposeToScript="true" GenerateEventBindings="true" Description="Number of seconds elapsed without a jump button press"/>
    <NetworkProperty Type="bool" Name="OnGround" Init="true" ReplicateFrom="Authority" ReplicateTo="Client" IsRewindable="true" IsPredictable="true" IsPublic="true" Container="Object" ExposeToEditor="false" ExposeToScript="true" GenerateEventBindings="true" Description="Tracks whether or not the player is currently on the ground"/>
    <NetworkProperty Type="bool" Name="WasOnGround" Init="true" ReplicateFrom="Authority" ReplicateTo="Autonomous" IsRewindable="true" IsPredictable="true" IsPublic="true" Container="Object" ExposeToEditor="false" ExposeToScript="true" GenerateEventBindings="true" Description="Tracks whether or not the player was previously on the ground in the last tick"/>
    <NetworkProperty Type="bool" Name="IsJumping" Init="false" ReplicateFrom="Authority" ReplicateTo="Autonomous" IsRewindable="true" IsPredictable="true" IsPublic="true" Container="Object" ExposeToEditor="false" ExposeToScript="true" GenerateEventBindings="true" Description="Tracks whether or not the player is still executing a jump"/>

    <NetworkInput Type="StickAxis" Name="ForwardAxis" Init="0.0f" />
    <NetworkInput Type="StickAxis" Name="StrafeAxis"  Init="0.0f" />
    <NetworkInput Type="MouseAxis" Name="ViewYaw"     Init="0.0f" />
    <NetworkInput Type="MouseAxis" Name="ViewPitch"   Init="0.0f" />
    <NetworkInput Type="bool"      Name="Sprint"      Init="false" />
    <NetworkInput Type="bool"      Name="Jump"        Init="false" />
    <NetworkInput Type="bool"      Name="Crouch"      Init="false" />
    <NetworkInput Type="uint8_t"   Name="ResetCount"  Init="0" />

    <RemoteProcedure
        Name="ApplyImpulse"
        InvokeFrom="Server"
        HandleOn="Authority"
        IsPublic="false"
        IsReliable="true"
        GenerateEventBindings="true"
        Description="Applies an impulse directly to the players self generated velocity">
        <Param Type="AZ::Vector3" Name="Impulse" />
        <Param Type="bool" Name="External" Description="If true, the impulse will be applied to the external velocity, and if false it will be applied to internal velocity" />
    </RemoteProcedure>

    <RemoteProcedure
        Name="SetVelocity"
        InvokeFrom="Server"
        HandleOn="Authority"
        IsPublic="false"
        IsReliable="true"
        GenerateEventBindings="true"
        Description="Directly sets the self generated velocity to the provided value, overriding any current velocity values">
        <Param Type="AZ::Vector3" Name="Velocity"/>
        <Param Type="bool" Name="External" Description="If true, the impulse will be applied to the external velocity, and if false it will be applied to internal velocity" />
    </RemoteProcedure>

    <ArchetypeProperty Type="float" Name="WalkSpeed"    Init="3.0f" ExposeToEditor="true" Description="Walk speed, units in meters per second" />
    <ArchetypeProperty Type="float" Name="SprintSpeed"  Init="5.0f" ExposeToEditor="true" Description="Sprint speed, units in meters per second" />
    <ArchetypeProperty Type="float" Name="ReverseSpeed" Init="2.0f" ExposeToEditor="true" Description="Reverse speed, units in meters per second" />
    <ArchetypeProperty Type="float" Name="CrouchSpeed"  Init="1.5f" ExposeToEditor="true" Description="Crouching speed, units in meters per second" />
    <ArchetypeProperty Type="float" Name="MaxJumpHeight"  Init="2.0f" ExposeToEditor="true" Description="Max vertical jump height in meters" />
    <ArchetypeProperty Type="float" Name="JumpPressQueuedSeconds"  Init="0.2f" ExposeToEditor="true" Description="How long in seconds before touching the ground that a jump can be triggered once the ground is reached." />
    <ArchetypeProperty Type="float" Name="JumpOnGroundQueuedSeconds"  Init="0.2f" ExposeToEditor="true" Description="How long in seconds after falling off the ground that a jump can still be triggered." />
</Component>
